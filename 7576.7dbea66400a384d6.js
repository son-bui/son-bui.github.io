"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[7576],{77576:(B,y,l)=>{l.r(y),l.d(y,{CreateRolePageComponent:()=>O,RoleManagePageComponent:()=>U});var m=l(36895),_=l(72506),d=l(83700),h=l(48373),Z=l(67460),A=l(28746),e=l(94650),x=l(14580),g=l(82761);function F(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"tr",12)(1,"td",13),e._uU(2),e.qZA(),e.TgZ(3,"td",13),e._uU(4),e.qZA(),e.TgZ(5,"td",14)(6,"button",15),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.edit(o.id))}),e._uU(7,"S\u1eeda"),e.qZA()()()}if(2&n){const t=a.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function T(n,a){1&n&&e._UZ(0,"cf-spinner")}const R=function(){return{num:25}},S=function(){return{num:50}},E=function(){return{num:75}},M=function(){return{num:100}},N=function(n,a,t,i){return[n,a,t,i]};let U=(()=>{class n{constructor(t,i,r){this._roleService=i,this._router=r,this.listOfData=[],this.pageSize=25,this.currentPage=1,this.isLoading=!1,this.sortChange=(o,s)=>{let u=s.map(p=>p);for(let p=0;p<o.length;p++){const b=o[p];"name"===b.key&&(u=u.sort("ascend"===b.sort?(C,v)=>this.increaseAlphabetSort(C.name,v.name):(C,v)=>this.decreaseAlphabetSort(C.name,v.name)))}return u},this.searchChange=(o,s)=>s,this.increaseAlphabetSort=(o,s)=>o<s?-1:o>s?1:0,this.decreaseAlphabetSort=(o,s)=>o>s?-1:o<s?1:0,t.registerIcons([]),this.onSearch()}onSearch(){this.isLoading=!0,this._roleService.getAllRole().pipe((0,A.x)(()=>this.isLoading=!1)).subscribe({next:t=>{this.listOfData=t.data}})}checkChange(t){this.pageSize=parseInt(t)}addRole(){this._router.navigate(["admin/create-role"])}edit(t){this._router.navigate([`admin/edit-role/${t}`])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.KNP),e.Y36(x.Nj),e.Y36(g.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["role-manage-page"]],standalone:!0,features:[e.jDz],decls:19,vars:17,consts:[[1,"py-4","px-[30px]","rounded-lg"],[1,"bg-neutral-white","rounded-lg","shadow-cf-md"],[1,"p-4","flex","justify-between","items-center"],[1,"text-heading-sm"],["cf-button","","type","secondary",3,"click"],[1,"",3,"fnSort","fnSearch","pageSizeList","listData","pageSize"],["managerTable",""],["cf-thead",""],["cf-th","",1,"whitespace-nowrap",3,"sortName"],["cf-th","",1,"whitespace-nowrap"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[1,"border-b","border-neutral-gray-1"],["cf-td","",1,"py-2","px-3","text-body-sm"],["cf-td","",1,"py-2","px-3"],["cf-button","","size","small","type","secondary",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"Qu\u1ea3n l\xfd quy\u1ec1n"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.addRole()}),e._uU(6," Th\xeam quy\u1ec1n "),e.qZA()(),e.TgZ(7,"cf-table",5,6)(9,"thead",7)(10,"th",8),e._uU(11,"Quy\u1ec1n"),e.qZA(),e.TgZ(12,"th",9),e._uU(13,"M\xf4 t\u1ea3"),e.qZA(),e.TgZ(14,"th",9),e._uU(15,"Thao t\xe1c"),e.qZA()(),e.TgZ(16,"tbody"),e.YNc(17,F,8,2,"ng-template",10),e.qZA()()()(),e.YNc(18,T,1,0,"cf-spinner",11)),2&t){const r=e.MAs(8);e.xp6(7),e.Q6J("fnSort",i.sortChange)("fnSearch",i.searchChange)("pageSizeList",e.l5B(12,N,e.DdM(8,R),e.DdM(9,S),e.DdM(10,E),e.DdM(11,M)))("listData",i.listOfData)("pageSize",i.pageSize),e.xp6(3),e.Q6J("sortName","name"),e.xp6(7),e.Q6J("ngForOf",r.partOfdata),e.xp6(1),e.Q6J("ngIf",i.isLoading)}},dependencies:[m.ez,m.sg,m.O5,_.AxE,d.N8,d.Xq,h.rC,h.E_,h.zs,h.qS,Z.OR],encapsulation:2}),n})();var c=l(24006),f=l(44143),q=l(27898),P=l(62331);function J(n,a){1&n&&e._UZ(0,"cf-input-hint",14),2&n&&e.Q6J("hint","Nh\u1eadp t\xean quy\u1ec1n")}function k(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",19)(1,"div")(2,"cf-checkbox",20),e.NdJ("checkChange",function(r){const s=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.permissionChange(r,s))}),e.TgZ(3,"div",21),e._uU(4),e.qZA()()()()}if(2&n){const t=a.$implicit;e.xp6(2),e.Q6J("checked",t.actived),e.xp6(2),e.hij(" ",t.description," ")}}function z(n,a){if(1&n&&(e.TgZ(0,"div",15)(1,"div",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17),e.YNc(4,k,5,2,"div",18),e.qZA()()),2&n){const t=a.$implicit;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Q6J("ngForOf",t.permissions)}}function D(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.submit())}),e._uU(1,"T\u1ea1o m\u1edbi"),e.qZA()}}function Q(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.submit())}),e._uU(1,"L\u01b0u"),e.qZA()}}let O=(()=>{class n{constructor(t,i,r,o,s){this._fb=t,this._roleService=i,this._router=r,this._toastService=o,this._route=s,this.allPermissionCategory=[],this.enabledPermission=[],this.editMode=!1,this.roleForm=t.group({name:["",c.kI.required],description:[""]}),s.snapshot.params.id?(this.editMode=!0,this.id=s.snapshot.params.id,this.initPermission(this.id)):this.initPermission(null)}initCurrentRolePermission(t){this._roleService.getRole(t).subscribe({next:i=>{this.allPermissionCategory.flatMap(r=>r.permissions).filter(r=>i.data.permissions.includes(r.name)).forEach(r=>this.permissionChange(!0,r)),this.roleForm.controls.name.setValue(i.data.name),this.roleForm.controls.description.setValue(i.data.description)},error:()=>{this._toastService.add({severity:"error",summary:"C\xf3 l\u1ed7i x\u1ea3y ra khi l\u1ea5y d\u1eef li\u1ec7u quy\u1ec1n",detail:"",sticky:!0})}})}initPermission(t){this._roleService.getAllPermission().subscribe({next:i=>{this.allPermissionCategory=i.data.map(r=>({description:r.description,name:r.name,permissions:r.permissions.map(o=>({description:o.description,category:o.category,name:o.name,isSecurityCritical:o.isSecurityCritical,impliedBy:o.impliedBy?o.impliedBy.map(s=>({description:s.description,category:s.category,name:s.name,isSecurityCritical:s.isSecurityCritical,impliedBy:[],actived:!1})):[],actived:!1}))})),t&&this.initCurrentRolePermission(this.id)}})}permissionChange(t,i){t?(i.actived=!0,this.allPermissionCategory.flatMap(o=>o.permissions).filter(o=>o.impliedBy.filter(s=>s.name===i.name).length>0).forEach(o=>o.actived=!0)):(this.removePermission(i),this.removePermissionImplied(i))}removePermission(t){t.actived=!1}removePermissionImplied(t){this.allPermissionCategory.flatMap(i=>i.permissions).filter(i=>i.impliedBy.filter(r=>r.name===t.name).length>0).forEach(i=>{this.removePermission(i)}),this.allPermissionCategory.flatMap(i=>i.permissions).filter(i=>t.impliedBy.map(r=>r.name).includes(i.name)).forEach(i=>this.removePermission(i))}submit(){this.enabledPermission=this.allPermissionCategory.flatMap(t=>t.permissions).filter(t=>t.actived).map(t=>t.name),this.enabledPermission=this.allPermissionCategory.flatMap(t=>t.permissions).filter(t=>!(!t.actived||t.impliedBy.length>0&&t.impliedBy.map(i=>i.name).filter(i=>this.enabledPermission.includes(i)).length>0)).map(t=>t.name),this.roleForm.valid&&(this.editMode?this.processUpdateRole():this.processCreateRole())}processCreateRole(){this._roleService.createRole({name:this.roleForm.controls.name.value,description:this.roleForm.controls.description.value,permissions:this.enabledPermission}).subscribe({next:t=>{this._router.navigate(["admin/role-manage"])},error:t=>{this._toastService.add({severity:"error",summary:"C\xf3 l\u1ed7i x\u1ea3y ra",detail:"",sticky:!0})}})}processUpdateRole(){this._roleService.updateRole({id:this.id,name:this.roleForm.controls.name.value,description:this.roleForm.controls.description.value,permissions:this.enabledPermission}).subscribe({next:t=>{this._router.navigate(["admin/role-manage"])},error:t=>{this._toastService.add({severity:"error",summary:"C\xf3 l\u1ed7i x\u1ea3y ra",detail:"",sticky:!0})}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(c.qu),e.Y36(x.Nj),e.Y36(g.F0),e.Y36(P.BX),e.Y36(g.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-create-role-page"]],standalone:!0,features:[e.jDz],decls:21,vars:8,consts:[[1,"flex","justify-center","py-4","px-[30px]","rounded-lg"],[1,"bg-neutral-white","rounded-lg","shadow-cf-md","w-[1000px]","max-w-[1000px]"],[1,"p-4","flex","justify-between","items-center"],[1,"text-heading-sm"],[1,"p-4"],[1,"grow-[400]","!w-full",3,"status"],["cfLabel","",1,"text-espressive-sm","text-black","mb-1.5"],["cf-input","","size","medium","placeholder","Nh\u1eadp t\xean",3,"formControl"],["cfHint","",3,"hint",4,"ngIf"],["cf-input","","size","medium","placeholder","Nh\u1eadp m\xf4 t\u1ea3",3,"formControl"],[1,"p-4","pt-0","flex","flex-col","gap-y-6"],["class","flex flex-col items-start gap-y-4",4,"ngFor","ngForOf"],[1,"p-4","flex","justify-end"],["cf-button","","size","medium","color","primary-1",3,"click",4,"ngIf"],["cfHint","",3,"hint"],[1,"flex","flex-col","items-start","gap-y-4"],[1,"text-espressive-md"],[1,"pl-2","text-neutral-gray-5","flex","flex-col","gap-y-4","w-full"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"flex","items-center"],["size","medium",3,"checked","checkChange"],[1,"text-espressive-md","text-neutral-gray-5"],["cf-button","","size","medium","color","primary-1",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"T\u1ea1o m\u1edbi quy\u1ec1n"),e.qZA()(),e.TgZ(5,"div",4)(6,"cf-input-group",5)(7,"label",6),e._uU(8," T\xean quy\u1ec1n "),e.qZA(),e._UZ(9,"input",7),e.YNc(10,J,1,1,"cf-input-hint",8),e.qZA(),e.TgZ(11,"cf-input-group",5)(12,"label",6),e._uU(13," M\xf4 t\u1ea3 "),e.qZA(),e._UZ(14,"input",9),e.qZA()(),e.TgZ(15,"div",10),e.YNc(16,z,5,2,"div",11),e.qZA(),e.TgZ(17,"div",12),e.YNc(18,D,2,0,"button",13),e.YNc(19,Q,2,0,"button",13),e.qZA()()(),e._UZ(20,"cf-toast")),2&t&&(e.xp6(6),e.Q6J("status",i.roleForm.controls.name.invalid&&(i.roleForm.controls.name.dirty||i.roleForm.controls.name.touched)?"error":"default"),e.xp6(3),e.Q6J("formControl",i.roleForm.controls.name),e.xp6(1),e.Q6J("ngIf",(null==i.roleForm.controls.name.errors?null:i.roleForm.controls.name.errors.required)&&(i.roleForm.controls.name.dirty||i.roleForm.controls.name.touched)),e.xp6(1),e.Q6J("status",i.roleForm.controls.name.invalid&&(i.roleForm.controls.description.dirty||i.roleForm.controls.description.touched)?"error":"default"),e.xp6(3),e.Q6J("formControl",i.roleForm.controls.description),e.xp6(2),e.Q6J("ngForOf",i.allPermissionCategory),e.xp6(2),e.Q6J("ngIf",!i.editMode),e.xp6(1),e.Q6J("ngIf",i.editMode))},dependencies:[m.ez,m.sg,m.O5,c.u5,c.Fj,c.JJ,c.UX,c.oH,f.j$,f.ND,f.BN,f.v2,q.u,d.N8,d.Xq,P.hj],encapsulation:2}),n})()}}]);