"use strict";(self.webpackChunkcheapflightclient=self.webpackChunkcheapflightclient||[]).push([[9716],{39716:(E,g,a)=>{a.r(g),a.d(g,{GaiComponent:()=>F});var d=a(36895),m=a(83700),p=a(44143),c=a(24006);const f={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var u,y=new Uint8Array(16);function T(){if(!u&&!(u=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(y)}for(var o=[],h=0;h<256;++h)o.push((h+256).toString(16).slice(1));const w=function C(t,i,n){if(f.randomUUID&&!i&&!t)return f.randomUUID();var s=(t=t||{}).random||(t.rng||T)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,i){n=n||0;for(var r=0;r<16;++r)i[n+r]=s[r];return i}return function _(t,i=0){return(o[t[i+0]]+o[t[i+1]]+o[t[i+2]]+o[t[i+3]]+"-"+o[t[i+4]]+o[t[i+5]]+"-"+o[t[i+6]]+o[t[i+7]]+"-"+o[t[i+8]]+o[t[i+9]]+"-"+o[t[i+10]]+o[t[i+11]]+o[t[i+12]]+o[t[i+13]]+o[t[i+14]]+o[t[i+15]]).toLowerCase()}(s)};var x=a(55471),e=a(94650),b=a(86938);const Z=["scrollChat"];function S(t,i){1&t&&(e.TgZ(0,"div",18),e._uU(1,"Ch\u01b0a c\xf3 cu\u1ed9c h\u1ed9i tho\u1ea1i n\xe0o"),e.qZA())}function k(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"div",19)(1,"div",20),e.NdJ("click",function(){const l=e.CHM(n).$implicit,M=e.oxw();return e.KtG(M.changeSession(l))}),e.TgZ(2,"div",21),e._uU(3),e.qZA()()()}if(2&t){const n=i.$implicit,s=e.oxw();e.xp6(1),e.ekj("bg-neutral-gray-1",s.sessionSelected.session_id===n.session_id),e.xp6(2),e.Oqu(n.description)}}function U(t,i){if(1&t&&(e.TgZ(0,"div",23)(1,"span",24),e._uU(2),e.qZA()()),2&t){const n=e.oxw().$implicit;e.xp6(2),e.Oqu(n.content)}}function G(t,i){if(1&t&&(e.TgZ(0,"div",25)(1,"div",26),e._UZ(2,"img",27),e.qZA(),e.TgZ(3,"div",28),e._UZ(4,"markdown",29),e.qZA()()),2&t){const n=e.oxw().$implicit;e.xp6(4),e.Q6J("data",n.content)}}function N(t,i){if(1&t&&(e.ynx(0),e.YNc(1,U,3,1,"div",22),e.YNc(2,G,5,1,"div",12),e.BQk()),2&t){const n=i.$implicit;e.xp6(1),e.Q6J("ngIf","human"==n.type),e.xp6(1),e.Q6J("ngIf","ai"==n.type||"AIMessageChunk"==n.type)}}function A(t,i){if(1&t&&(e.TgZ(0,"div",25)(1,"div",26),e._UZ(2,"img",27),e.qZA(),e.TgZ(3,"div",28),e._UZ(4,"markdown",29),e.qZA()()),2&t){const n=e.oxw();e.xp6(4),e.Q6J("data",n.streamingText)}}let F=(()=>{class t{constructor(n,s){this._aiService=n,this._cdr=s,this.isNewSession=!0,this.sessions=[],this.sessionSelected={session_id:"",user_id:"",description:""},this.inputText="",this.humanMessage="",this.messages=[],this.streamingText=""}ngOnInit(){this.loadSessions(),this.createNewSession()}loadSessions(){this._aiService.getAllConversation().subscribe({next:n=>{this.sessions=n.map(s=>({user_id:s.user_id,session_id:s.session_id,description:this.upperFirstLetter(s.description)}))}})}createNewSession(){this.isNewSession=!0,this.sessionSelected={session_id:w(),user_id:"",description:""},this.messages=[]}changeSession(n){this.isNewSession=!1,this.sessionSelected=n,this._aiService.getSessionHistory(this.sessionSelected.session_id).subscribe({next:s=>{this.messages=s,this.scrollToBottom()}})}ignoreTextAreaEnterDefault(n){n.preventDefault()}sendMessage(){""!=this.inputText&&(this.humanMessage=this.inputText,this.messages.push({content:this.humanMessage,type:"human"}),this.inputText="",this._cdr.markForCheck(),this.scrollToBottom(),this.callChat())}callChat(){this._aiService.chatv2(this.sessionSelected.session_id,this.humanMessage).subscribe({next:n=>{this.streamingText=n,this.scrollToBottom()},complete:()=>{this.messages.push({content:this.streamingText,type:"ai"}),this.streamingText="",this.isNewSession&&(this.sessions.push({session_id:this.sessionSelected.session_id,user_id:"",description:this.upperFirstLetter(this.humanMessage)}),this.isNewSession=!1),this._cdr.markForCheck(),this.scrollToBottom()},error:n=>{401==n&&this._aiService.getAllConversation().subscribe({next:s=>{this.callChat()}})}})}scrollToBottom(){setTimeout(()=>{this.scrollChatContainer.nativeElement.scrollTop=this.scrollChatContainer.nativeElement.scrollHeight})}upperFirstLetter(n){return n&&n[0].toUpperCase()+n.slice(1)||""}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(b.Y),e.Y36(e.sBO))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-gai"]],viewQuery:function(n,s){if(1&n&&e.Gf(Z,5),2&n){let r;e.iGM(r=e.CRH())&&(s.scrollChatContainer=r.first)}},standalone:!0,features:[e.jDz],decls:20,vars:6,consts:[[1,"w-full","h-[calc(100vh-80px)]","p-4","bg-neutral-gray-1"],[1,"bg-white","w-full","h-full","rounded","flex"],[1,"w-[300px]","h-full","border-r","border-r-neutral-gray-1","shrink-0","flex","flex-col"],[1,"border-b","border-b-neutral-gray-1","p-2","flex","items-center","justify-center","mb-1"],["cf-button","",1,"",3,"click"],[1,"flex","flex-col-reverse","overflow-y-auto"],["class","text-body-sm flex justify-center px-2 py-1",4,"ngIf"],["class","px-2 py-0.5",4,"ngFor","ngForOf"],[1,"flex","w-full","h-full","flex-col"],[1,"w-full","h-full","overflow-x-hidden","p-3","space-y-5","scroll-smooth","flex","flex-col","relative"],["scrollChat",""],[4,"ngFor","ngForOf"],["class","flex space-x-2 w-full",4,"ngIf"],[1,"h-[10px]","shrink-0"],[1,"shrink-0","bottom-0","w-full","p-2","bg-white","border-t","border-t-neutral-gray-1","flex","justify-center","items-center","space-x-2"],[1,"!w-[80%]"],["cf-input","",1,"w-[80%]","resize-none",3,"rows","ngModel","ngModelChange","keydown.enter","keyup.enter"],["cf-button","",3,"click"],[1,"text-body-sm","flex","justify-center","px-2","py-1"],[1,"px-2","py-0.5"],[1,"px-2","py-1","rounded","hover:bg-neutral-gray-1","cursor-pointer",3,"click"],[1,"line-clamp-1"],["class","rounded-2xl py-2 px-4 bg-neutral-gray-1 max-w-[80%] w-fit self-end",4,"ngIf"],[1,"rounded-2xl","py-2","px-4","bg-neutral-gray-1","max-w-[80%]","w-fit","self-end"],[1,"whitespace-break-spaces"],[1,"flex","space-x-2","w-full"],[1,"w-5","h-5","rounded-full","shrink-0"],["src","/assets/logo/small_logo.png",1,"w-5","h-5"],[1,"rounded","px-2","leading-8"],[3,"data"]],template:function(n,s){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return s.createNewSession()}),e._uU(5,"T\u1ea1o tr\xf2 chuy\u1ec7n m\u1edbi"),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,S,2,0,"div",6),e.YNc(8,k,4,3,"div",7),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9,10),e.YNc(12,N,3,2,"ng-container",11),e.YNc(13,A,5,1,"div",12),e._UZ(14,"div",13),e.qZA(),e.TgZ(15,"div",14)(16,"cf-input-group",15)(17,"textarea",16),e.NdJ("ngModelChange",function(l){return s.inputText=l})("keydown.enter",function(l){return s.ignoreTextAreaEnterDefault(l)})("keyup.enter",function(){return s.sendMessage()}),e.qZA()(),e.TgZ(18,"button",17),e.NdJ("click",function(){return s.sendMessage()}),e._uU(19,"G\u1eedi"),e.qZA()()()()()),2&n&&(e.xp6(7),e.Q6J("ngIf",0==s.sessions.length),e.xp6(1),e.Q6J("ngForOf",s.sessions),e.xp6(4),e.Q6J("ngForOf",s.messages),e.xp6(1),e.Q6J("ngIf",s.streamingText),e.xp6(4),e.Q6J("rows",1)("ngModel",s.inputText))},dependencies:[d.ez,d.sg,d.O5,m.N8,m.Xq,p.j$,p.ND,p.BN,c.u5,c.Fj,c.JJ,c.On,x.JP,x.lF],styles:["ul{list-style:revert;margin:0;padding:revert}  p{margin-bottom:16px!important}  p, li[_ngcontent-%COMP%]{white-space:break-spaces}"]}),t})()}}]);